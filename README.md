
# ğŸ“š DeepSeek DevDocs RAG (å¼€å‘æ–‡æ¡£æ™ºèƒ½åŠ©æ‰‹)

è¿™æ˜¯ä¸€ä¸ªåŸºäº **DeepSeek-V3** å’Œ **LangChain** æ„å»ºçš„æœ¬åœ°åŒ–æ£€ç´¢å¢å¼ºç”Ÿæˆ (RAG) ç³»ç»Ÿã€‚ä¸“ä¸º**æŠ€æœ¯å¼€å‘æ–‡æ¡£**è®¾è®¡ï¼Œèƒ½å¤Ÿç²¾å‡†ç†è§£ä»£ç ä¸Šä¸‹æ–‡ï¼Œæä¾›åŸºäºæ–‡æ¡£çš„æ™ºèƒ½é—®ç­”ã€‚

æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š**Markdown ç»“æ„åŒ–åˆ†å—**ã€**ä»£ç å—å®Œæ•´æ€§ä¿æŠ¤**ã€**æœ¬åœ° Embedding/Rerank æ¨¡å‹åŠ é€Ÿ**ä»¥åŠ**æµå¼å¯¹è¯ä½“éªŒ**ã€‚

---

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

* **ğŸ§  æ·±åº¦è¯­ä¹‰ç†è§£**: æ¥å…¥ **DeepSeek API** (V3/Coder)ï¼Œæ“…é•¿ä»£ç è§£é‡Šä¸æŠ€æœ¯æ¨ç†ã€‚
* **ğŸ”ª æ™ºèƒ½æ–‡æ¡£åˆ‡åˆ†**: é‡‡ç”¨ `MarkdownHeaderSplitter` ä¿ç•™ç« èŠ‚å±‚çº§ï¼Œå¹¶é’ˆå¯¹ä»£ç å— (`Code Block`) è¿›è¡Œç‰¹æ®Šä¿æŠ¤ï¼Œé˜²æ­¢ä»£ç é€»è¾‘è¢«åˆ‡æ–­ã€‚
* **ğŸ” åŒé‡æ£€ç´¢æœºåˆ¶**:
* **ç²—æ’**: åŸºäº `Qwen-Embedding` + ChromaDB è¿›è¡Œå‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ã€‚
* **ç²¾æ’**: ä½¿ç”¨ `BGE-Reranker` å¯¹ Top-N ç»“æœè¿›è¡Œè¯­ä¹‰é‡æ’åºï¼Œå¤§å¹…æå‡å‡†ç¡®ç‡ã€‚


* **âš¡ æœ¬åœ°æ¨¡å‹åŠ é€Ÿ**: Embedding å’Œ Rerank æ¨¡å‹é€šè¿‡ **vLLM** æœ¬åœ°éƒ¨ç½²ï¼Œä½å»¶è¿Ÿä¸”æ•°æ®éšç§å¯æ§ã€‚
* **ğŸ’» æç®€äº¤äº’**: åŸºäº **Gradio** çš„ç°ä»£åŒ– Web UIï¼Œæ”¯æŒæµå¼è¾“å‡ºå’Œå®æ—¶ç´¢å¼•æ„å»ºã€‚


---

## âš™ï¸ ç¯å¢ƒå‡†å¤‡

### 1. åŸºç¡€ç¯å¢ƒ

* Python 3.10+
* NVIDIA GPU (æ˜¾å­˜å»ºè®® >= 16GBï¼Œç”¨äºè¿è¡Œæœ¬åœ° Embedding/Rerank æ¨¡å‹)
* DeepSeek API Key

### 2. å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
conda create -n rag_env python=3.10
conda activate rag_env

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

```

*(æ³¨ï¼šè¯·ç¡®ä¿å·²å®‰è£… `langchain`, `gradio`, `pydantic>=2.0` ç­‰æ ¸å¿ƒåº“)*

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### ç¬¬ä¸€æ­¥ï¼šé…ç½®å¯†é’¥

åœ¨ `config/` ç›®å½•ä¸‹åˆ›å»º `secrets.env` æ–‡ä»¶ï¼š

```env
# config/secrets.env
DEEPSEEK_API_KEY=sk-your-deepseek-api-key-here

```

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨æœ¬åœ°æ¨¡å‹æœåŠ¡ (vLLM)

æœ¬é¡¹ç›®ä¾èµ–ä¸¤ä¸ªæœ¬åœ°æ¨¡å‹æ¥å£ï¼Œè¯·ç¡®ä¿å®ƒä»¬åœ¨åå°è¿è¡Œã€‚

**1. å¯åŠ¨ Embedding æœåŠ¡ (ç«¯å£ 4061)**

```bash
CUDA_VISIBLE_DEVICES=0 vllm serve /mnt/modelScope/Qwen3-Embedding-8B \
--port 4061 \
--served-model-name Qwen3-Embedding-8B \
--gpu-memory-utilization 0.5 \
--max-model-len 4096

```

**2. å¯åŠ¨ Rerank æœåŠ¡ (ç«¯å£ 4062)**

```bash
CUDA_VISIBLE_DEVICES=1 vllm serve /mnt/modelScope/bge-reranker-v2-m3 \
--port 4062 \
--served-model-name bge-reranker-v2-m3 \
--gpu-memory-utilization 0.3

```

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œåº”ç”¨

```bash
python src/app/gradio_app.py

```

å¯åŠ¨æˆåŠŸåï¼Œæµè§ˆå™¨è®¿é—® `http://localhost:7860`ã€‚

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

1. **å‡†å¤‡æ•°æ®**: å°†ä½ çš„å¼€å‘æ–‡æ¡£ï¼ˆMarkdown æ ¼å¼ï¼Œ`.md`ï¼‰æ”¾å…¥ `data/raw/` ç›®å½•ã€‚
2. **æ„å»ºç´¢å¼•**:
* åœ¨ç½‘é¡µå·¦ä¾§ä¾§è¾¹æ è¾“å…¥æ–‡æ¡£è·¯å¾„ï¼ˆé»˜è®¤ `./data/raw`ï¼‰ã€‚
* ç‚¹å‡» **"ğŸ”„ é‡å»ºç´¢å¼•"** æŒ‰é’®ã€‚
* è§‚å¯Ÿæ—¥å¿—è¾“å‡ºï¼Œç­‰å¾…â€œç´¢å¼•æ„å»ºå®Œæˆâ€ã€‚


3. **å¼€å§‹å¯¹è¯**:
* åœ¨å³ä¾§èŠå¤©æ¡†è¾“å…¥æŠ€æœ¯é—®é¢˜ï¼ˆä¾‹å¦‚ï¼šâ€œå¦‚ä½•é…ç½® Docker å®¹å™¨ï¼Ÿâ€ï¼‰ã€‚
* ç³»ç»Ÿå°†æ£€ç´¢æ–‡æ¡£å¹¶æµå¼è¾“å‡ºç­”æ¡ˆã€‚



---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```text
doc-rag-system/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ secrets.env          # API å¯†é’¥é…ç½®
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                 # åŸå§‹ Markdown æ–‡æ¡£å­˜æ”¾å¤„
â”‚   â””â”€â”€ vector_store/        # ChromaDB æŒä¹…åŒ–æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ gradio_app.py    # Gradio å‰ç«¯å…¥å£
â”‚   â”‚   â””â”€â”€ chain.py         # RAG æ ¸å¿ƒé“¾ç»„è£…
â”‚   â”œâ”€â”€ embedding/
â”‚   â”‚   â”œâ”€â”€ embedder.py      # Embedding æ¨¡å‹å®¢æˆ·ç«¯ (HTTP)
â”‚   â”‚   â””â”€â”€ vector_db.py     # ChromaDB ç®¡ç†
â”‚   â”œâ”€â”€ ingestion/           # æ•°æ®å¤„ç†æµæ°´çº¿
â”‚   â”‚   â”œâ”€â”€ loader.py        # æ–‡æ¡£åŠ è½½
â”‚   â”‚   â”œâ”€â”€ splitter.py      # æ™ºèƒ½åˆ†å—ç­–ç•¥
â”‚   â”‚   â””â”€â”€ cleaner.py       # æ•°æ®æ¸…æ´—
â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â””â”€â”€ deepseek_client.py # DeepSeek API å°è£…
â”‚   â””â”€â”€ retrieval/
â”‚   â”‚   â”œâ”€â”€ reranker.py      # Rerank æ¨¡å‹å®¢æˆ·ç«¯ (HTTP)
â”‚   â”‚   â””â”€â”€ search.py        # æ£€ç´¢å™¨ç»„åˆé€»è¾‘
â””â”€â”€ requirements.txt         # ä¾èµ–åˆ—è¡¨

```

---

## ğŸ”§ å¸¸è§é—®é¢˜ (FAQ)

**Q: æŠ¥é”™ `400 Bad Request` (Input should be a valid string)?**
A: è¿™æ˜¯ç”±äº Gradio ä¼ å…¥äº†å¤šæ¨¡æ€æ ¼å¼æˆ– LangChain æ„é€ äº†å¤æ‚çš„ Payloadã€‚æœ¬é¡¹ç›®å·²åœ¨ `embedder.py` å’Œ `reranker.py` ä¸­å®ç°äº†æ¸…æ´—é€»è¾‘ï¼Œè¯·ç¡®ä¿ä½¿ç”¨çš„æ˜¯æœ€æ–°ä»£ç ã€‚

**Q: ä¸ºä»€ä¹ˆä»£ç å—åœ¨å›ç­”ä¸­æ˜¾ç¤ºä¸å…¨ï¼Ÿ**
A: è¯·æ£€æŸ¥åŸå§‹ Markdown æ–‡æ¡£çš„ä»£ç å—æ ‡è®°ï¼ˆ```ï¼‰æ˜¯å¦è§„èŒƒã€‚æœ¬é¡¹ç›®çš„ `splitter.py` ä¼˜å…ˆä¿æŠ¤ä»£ç å—ä¸è¢«åˆ‡åˆ†ã€‚

**Q: å¦‚ä½•æ›´æ¢æœ¬åœ°æ¨¡å‹ï¼Ÿ**
A: ä¿®æ”¹ `embedder.py` å’Œ `reranker.py` ä¸­çš„ `model_name` å’Œç«¯å£å·ï¼Œå¹¶ç¡®ä¿ vLLM å¯åŠ¨å‘½ä»¤å¯¹åº”å³å¯ã€‚

